// –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∞ (–ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ)
const questions = [
    {
        id: 1,
        type: 'case',
        question: '–ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ö–ï–ô–°: –í—ã –Ω–∞—à–ª–∏ –±–∞–≥: –∫–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ö–∞–∫–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞ –±—É–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º?',
        answers: [
            '–û—à–∏–±–∫–∞',
            '–ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç',
            '–ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ñ–æ—Ä–º—ã –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏',
            '–§–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è'
        ],
        correct: 2,
        explanation: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º - —É–∫–∞–∑–∞—Ç—å —á—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å (–∫–Ω–æ–ø–∫–∞) –∏ –≥–¥–µ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ñ–æ—Ä–º—ã).'
    },
    {
        id: 2,
        type: 'case',
        question: '–ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ö–ï–ô–°: –í –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–µ —É–∫–∞–∑–∞–Ω—ã —à–∞–≥–∏: 1. –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç 2. –ù–∞–π—Ç–∏ —Ñ–æ—Ä–º—É 3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É 4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É. –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å —ç—Ç–∏–º–∏ —à–∞–≥–∞–º–∏?',
        answers: [
            '–®–∞–≥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ',
            '–®–∞–≥–∏ —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–µ, –Ω–µ —É–∫–∞–∑–∞–Ω–æ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å',
            '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–∞',
            '–ù–µ —É–∫–∞–∑–∞–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç'
        ],
        correct: 1,
        explanation: '–®–∞–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ - —É–∫–∞–∑–∞—Ç—å –∫–∞–∫–∏–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—Ç—å, –∫–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —á—Ç–æ–±—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫ –º–æ–≥ —Ç–æ—á–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.'
    },
    {
        id: 3,
        type: 'single',
        question: '–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–µ?',
        answers: [
            '–ß—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—ã –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å',
            '–ß—Ç–æ–±—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–Ω—è–ª, —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å',
            '–ß—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–ª–æ–º–∞–ª–æ—Å—å',
            '–í—Å–µ –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ'
        ],
        correct: 3
    },
    {
        id: 4,
        type: 'single',
        question: '–ö–∞–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã –µ—Å—Ç—å –≤ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –¥–µ—Ñ–µ–∫—Ç–∞?',
        answers: [
            'New, Open, Fixed, Closed, Reopened',
            '–ù–∞–π–¥–µ–Ω, –ò—Å–ø—Ä–∞–≤–ª–µ–Ω, –ó–∞–∫—Ä—ã—Ç',
            '–ö—Ä–∏—Ç–∏—á–Ω—ã–π, –í—ã—Å–æ–∫–∏–π, –°—Ä–µ–¥–Ω–∏–π, –ù–∏–∑–∫–∏–π',
            '–ù–æ–≤—ã–π, –°—Ç–∞—Ä—ã–π, –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π'
        ],
        correct: 0
    },
    {
        id: 5,
        type: 'single',
        question: '–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "New" –≤ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –¥–µ—Ñ–µ–∫—Ç–∞?',
        answers: [
            '–ë–∞–≥ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–Ω –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç',
            '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∑—è–ª –±–∞–≥ –≤ —Ä–∞–±–æ—Ç—É',
            '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–ø—Ä–∞–≤–∏–ª –±–∞–≥',
            'QA –ø—Ä–æ–≤–µ—Ä–∏–ª, —á—Ç–æ –±–∞–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω'
        ],
        correct: 0
    },
    {
        id: 6,
        type: 'single',
        question: '–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "Fixed" –≤ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –¥–µ—Ñ–µ–∫—Ç–∞?',
        answers: [
            '–ë–∞–≥ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–Ω –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç',
            '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∑—è–ª –±–∞–≥ –≤ —Ä–∞–±–æ—Ç—É',
            '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–ø—Ä–∞–≤–∏–ª –±–∞–≥',
            'QA –ø—Ä–æ–≤–µ—Ä–∏–ª, —á—Ç–æ –±–∞–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω'
        ],
        correct: 2
    },
    {
        id: 7,
        type: 'single',
        question: '–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "Reopened" –≤ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –¥–µ—Ñ–µ–∫—Ç–∞?',
        answers: [
            '–ë–∞–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω',
            '–ë–∞–≥ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É',
            '–ë–∞–≥ –∑–∞–∫—Ä—ã—Ç',
            '–ë–∞–≥ –≤ —Ä–∞–±–æ—Ç–µ'
        ],
        correct: 1
    },
    {
        id: 8,
        type: 'case',
        question: '–ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ö–ï–ô–°: –í—ã –Ω–∞—à–ª–∏ –±–∞–≥ - –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É. –ö–∞–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É —ç—Ç–æ–≥–æ –±–∞–≥–∞?',
        answers: [
            '–í—ã—Å–æ–∫–∏–π - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫—Ä–∏—Ç–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç',
            '–°—Ä–µ–¥–Ω–∏–π - —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –µ—Å—Ç—å –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å',
            '–ù–∏–∑–∫–∏–π - –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞',
            '–ù–µ –≤–∞–∂–Ω–æ'
        ],
        correct: 0,
        explanation: '–ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - —ç—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É). –≠—Ç–æ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.'
    },
    {
        id: 9,
        type: 'case',
        question: '–ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ö–ï–ô–°: –í—ã –Ω–∞—à–ª–∏ –±–∞–≥ - –æ–ø–µ—á–∞—Ç–∫–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ–± –æ—à–∏–±–∫–µ ("–û—à–±–∫–∞" –≤–º–µ—Å—Ç–æ "–û—à–∏–±–∫–∞"). –ö–∞–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É —ç—Ç–æ–≥–æ –±–∞–≥–∞?',
        answers: [
            '–í—ã—Å–æ–∫–∏–π - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
            '–°—Ä–µ–¥–Ω–∏–π - —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ',
            '–ù–∏–∑–∫–∏–π - –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å',
            '–ù–µ –≤–∞–∂–Ω–æ'
        ],
        correct: 2,
        explanation: '–û–ø–µ—á–∞—Ç–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ - —ç—Ç–æ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å. –≠—Ç–æ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.'
    },
    {
        id: 10,
        type: 'multiple',
        question: '–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞? (–≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ)',
        answers: [
            '–ó–∞–≥–æ–ª–æ–≤–æ–∫',
            '–û–ø–∏—Å–∞–Ω–∏–µ',
            '–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è',
            '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏'
        ],
        correct: [0, 1, 2]
    },
    {
        id: 11,
        type: 'single',
        question: '–ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–µ?',
        answers: [
            '–ß—Ç–æ–±—ã –±—ã–ª–æ –∫—Ä–∞—Å–∏–≤–æ',
            '–ß—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤–∏–∑—É–∞–ª—å–Ω–æ –∏ –ø–æ–º–æ—á—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –±—ã—Å—Ç—Ä–µ–µ –ø–æ–Ω—è—Ç—å –ø—Ä–æ–±–ª–µ–º—É',
            '–ß—Ç–æ–±—ã —Å–∫—Ä–∏–Ω—à–æ—Ç –±—ã–ª –±–æ–ª—å—à–µ',
            '–°–∫—Ä–∏–Ω—à–æ—Ç—ã –Ω–µ –Ω—É–∂–Ω—ã'
        ],
        correct: 1
    },
    {
        id: 12,
        type: 'single',
        question: '–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ—Ç–µ—Å—Ç –≤ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –¥–µ—Ñ–µ–∫—Ç–∞?',
        answers: [
            '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –±–∞–≥–∞ QA',
            '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π',
            '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏',
            '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º'
        ],
        correct: 0
    }
];

let currentQuestionIndex = 0;
let userAnswers = {};
let totalQuestions = questions.length;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('total-questions').textContent = totalQuestions;
    document.getElementById('total-questions-counter').textContent = totalQuestions;
    
    document.getElementById('start-btn').addEventListener('click', startTest);
    document.getElementById('next-btn').addEventListener('click', nextQuestion);
    document.getElementById('prev-btn').addEventListener('click', prevQuestion);
    document.getElementById('finish-btn').addEventListener('click', finishTest);
    document.getElementById('restart-btn').addEventListener('click', restartTest);
});

function startTest() {
    document.getElementById('intro-screen').classList.remove('active');
    document.getElementById('test-screen').classList.add('active');
    currentQuestionIndex = 0;
    userAnswers = {};
    showQuestion();
}

function showQuestion() {
    const question = questions[currentQuestionIndex];
    const container = document.getElementById('question-container');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
    document.getElementById('current-question').textContent = currentQuestionIndex + 1;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞
    let questionTypeLabel = '';
    if (question.type === 'single') {
        questionTypeLabel = '–í—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞';
    } else if (question.type === 'multiple') {
        questionTypeLabel = '–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä';
    } else if (question.type === 'case') {
        questionTypeLabel = '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å';
    }
    
    // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
    let html = `<div class="question">
        <span class="question-type">${questionTypeLabel}</span>
        <div>${question.question}</div>
    </div>`;
    
    html += '<ul class="answers">';
    question.answers.forEach((answer, index) => {
        const inputType = question.type === 'multiple' ? 'checkbox' : 'radio';
        const inputName = question.type === 'multiple' ? `question-${question.id}-${index}` : `question-${question.id}`;
        const checked = userAnswers[question.id] && 
            (question.type === 'multiple' 
                ? userAnswers[question.id].includes(index)
                : userAnswers[question.id] === index) ? 'checked' : '';
        
        html += `
            <li class="answer-item">
                <label class="answer-label">
                    <input type="${inputType}" name="${inputName}" value="${index}" ${checked}>
                    <span class="answer-text">${answer}</span>
                </label>
            </li>
        `;
    });
    html += '</ul>';
    
    container.innerHTML = html;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    const inputs = container.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('change', function() {
            saveAnswer();
            updateNavigationButtons();
        });
    });
    
    updateNavigationButtons();
}

function saveAnswer() {
    const question = questions[currentQuestionIndex];
    const inputs = document.querySelectorAll(`input[name^="question-${question.id}"]`);
    
    if (question.type === 'multiple') {
        const selected = [];
        inputs.forEach(input => {
            if (input.checked) {
                selected.push(parseInt(input.value));
            }
        });
        userAnswers[question.id] = selected.length > 0 ? selected : null;
    } else {
        inputs.forEach(input => {
            if (input.checked) {
                userAnswers[question.id] = parseInt(input.value);
            }
        });
    }
}

function updateNavigationButtons() {
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const finishBtn = document.getElementById('finish-btn');
    
    prevBtn.disabled = currentQuestionIndex === 0;
    
    if (currentQuestionIndex === totalQuestions - 1) {
        nextBtn.style.display = 'none';
        finishBtn.style.display = 'inline-block';
    } else {
        nextBtn.style.display = 'inline-block';
        finishBtn.style.display = 'none';
    }
}

function nextQuestion() {
    if (currentQuestionIndex < totalQuestions - 1) {
        currentQuestionIndex++;
        showQuestion();
    }
}

function prevQuestion() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        showQuestion();
    }
}

function finishTest() {
    saveAnswer();
    showResults();
}

function showResults() {
    document.getElementById('test-screen').classList.remove('active');
    document.getElementById('results-screen').classList.add('active');
    
    let correctCount = 0;
    const resultsDetails = document.getElementById('results-details');
    let detailsHTML = '';
    
    questions.forEach((question, index) => {
        const userAnswer = userAnswers[question.id];
        let isCorrect = false;
        
        if (question.type === 'multiple') {
            if (userAnswer && Array.isArray(userAnswer)) {
                const userSet = new Set(userAnswer.sort());
                const correctSet = new Set(question.correct.sort());
                isCorrect = userSet.size === correctSet.size && 
                           [...userSet].every(val => correctSet.has(val));
            }
        } else {
            isCorrect = userAnswer === question.correct;
        }
        
        if (isCorrect) {
            correctCount++;
        }
        
        detailsHTML += `<div class="result-item ${isCorrect ? 'correct' : 'incorrect'}">`;
        detailsHTML += `<div class="result-question">${index + 1}. ${question.question}</div>`;
        
        if (question.type === 'multiple') {
            const correctAnswersText = question.correct.map(idx => question.answers[idx]).join(', ');
            const userAnswersText = userAnswer && userAnswer.length > 0
                ? userAnswer.map(idx => question.answers[idx]).join(', ')
                : '–ù–µ –æ—Ç–≤–µ—á–µ–Ω–æ';
            
            detailsHTML += `<div class="result-answer">`;
            detailsHTML += `<span class="correct-answer">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã: ${correctAnswersText}</span>`;
            if (!isCorrect) {
                detailsHTML += `<span class="user-answer">‚úó –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã: ${userAnswersText}</span>`;
            } else {
                detailsHTML += `<span class="correct-answer">‚úì –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!</span>`;
            }
            detailsHTML += `</div>`;
        } else {
            const correctAnswerText = question.answers[question.correct];
            const userAnswerText = userAnswer !== undefined && userAnswer !== null 
                ? question.answers[userAnswer] 
                : '–ù–µ –æ—Ç–≤–µ—á–µ–Ω–æ';
            
            detailsHTML += `<div class="result-answer">`;
            detailsHTML += `<span class="correct-answer">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswerText}</span>`;
            if (!isCorrect) {
                detailsHTML += `<span class="user-answer">‚úó –í–∞—à –æ—Ç–≤–µ—Ç: ${userAnswerText}</span>`;
            } else {
                detailsHTML += `<span class="correct-answer">‚úì –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!</span>`;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∫–µ–π—Å–æ–≤
            if (question.type === 'case' && question.explanation) {
                detailsHTML += `<div class="explanation">üí° <strong>–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:</strong> ${question.explanation}</div>`;
            }
            
            detailsHTML += `</div>`;
        }
        
        detailsHTML += `</div>`;
    });
    
    resultsDetails.innerHTML = detailsHTML;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    document.getElementById('score-percentage').textContent = percentage;
    document.getElementById('correct-answers').textContent = correctCount;
    document.getElementById('total-answers').textContent = totalQuestions;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ localStorage
    localStorage.setItem('lastTestScore', percentage);
    localStorage.setItem('lastTestDate', new Date().toLocaleString('ru-RU'));
}

function restartTest() {
    document.getElementById('results-screen').classList.remove('active');
    document.getElementById('intro-screen').classList.add('active');
    currentQuestionIndex = 0;
    userAnswers = {};
}

